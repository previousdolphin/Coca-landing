<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoCA | Entity Relationship Map</title>
    
    <!-- Import Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <style>
        /* --- GLOBAL ARCHITECTURE (INHERITED) --- */
        :root {
            /* DEFAULT: DARK MODE (The Void) */
            --bg-color: #050505;
            --paper-color: #0a0a0a;
            --text-color: #b0b0b0;
            --header-color: #ffffff;
            --accent-color: #F40009; /* CoCA RED */
            --terminal-green: #00ff41;
            --link-blue: #2b00ff;
            --border-style: 1px solid #333;
            
            --font-main: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            --font-mono: 'Courier New', Courier, monospace;
        }

        /* LIGHT MODE (The Legal Pad) */
        [data-theme="light"] {
            --bg-color: #f0f0f0;
            --paper-color: #ffffff;
            --text-color: #333333;
            --header-color: #000000;
            --border-style: 1px solid #000;
            --accent-color: #cc0000;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-mono); /* Defaulting to Mono for "Boring" look */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            letter-spacing: 0.02em;
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        /* Noise Filter Background */
        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.08'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: -1;
        }

        /* --- THEME TOGGLE --- */
        .theme-toggle {
            position: fixed; top: 20px; right: 20px;
            background: transparent; border: 1px solid var(--text-color);
            color: var(--text-color); font-family: var(--font-mono);
            font-size: 10px; padding: 5px 10px; cursor: pointer;
            z-index: 2000; text-transform: uppercase; opacity: 0.5;
        }
        .theme-toggle:hover { opacity: 1; border-color: var(--header-color); }

        /* --- DOCUMENT LAYOUT --- */
        .legal-doc {
            width: 100%;
            max-width: 900px;
            background: var(--paper-color);
            border: var(--border-style);
            padding: 40px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            position: relative;
        }

        header {
            border-bottom: 2px solid var(--text-color);
            padding-bottom: 20px;
            margin-bottom: 40px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        h1 {
            font-family: var(--font-main);
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--header-color);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .meta-data {
            font-size: 0.7rem;
            text-align: right;
            opacity: 0.7;
            line-height: 1.4;
        }

        /* --- WEBGL CONTAINER (FIGURE A) --- */
        .figure-container {
            width: 100%;
            height: 400px;
            border: 1px solid var(--text-color);
            margin-bottom: 40px;
            position: relative;
            background: #000; /* Always dark for the 3D view contrast */
            overflow: hidden;
        }
        
        .figure-caption {
            position: absolute;
            bottom: 10px;
            left: 10px;
            font-size: 0.7rem;
            color: #fff;
            background: rgba(0,0,0,0.7);
            padding: 2px 5px;
            pointer-events: none;
        }

        #webgl-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        /* --- ENTITY DEFINITIONS --- */
        .entity-section {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 20px;
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 1px dashed var(--text-color);
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }

        .entity-section:hover, .entity-section.active {
            opacity: 1;
        }
        
        .entity-section.active .entity-name {
            color: var(--accent-color);
            border-left-color: var(--accent-color);
        }

        .entity-header {
            text-align: right;
            padding-right: 20px;
        }

        .entity-name {
            font-size: 1rem;
            font-weight: bold;
            color: var(--header-color);
            text-transform: uppercase;
            margin-bottom: 5px;
            display: block;
            border-left: 3px solid transparent;
            padding-left: 10px;
            transition: all 0.2s;
            cursor: help;
        }

        .entity-type {
            font-size: 0.7rem;
            font-style: italic;
            display: block;
        }

        .entity-body {
            font-size: 0.85rem;
            line-height: 1.5;
        }

        .relation-tag {
            display: inline-block;
            background: rgba(128,128,128,0.1);
            border: 1px solid var(--text-color);
            padding: 2px 6px;
            font-size: 0.65rem;
            margin-right: 5px;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        /* --- VENDOR STACK --- */
        .vendor-box {
            margin-top: 15px;
            background: rgba(0,0,0,0.02);
            border-left: 1px solid var(--text-color);
            padding: 10px 15px;
        }
        
        .vendor-title {
            font-size: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 8px;
            opacity: 0.6;
        }

        .vendor-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .vendor-item {
            font-size: 0.75rem;
            color: var(--header-color);
            border-bottom: 1px dotted var(--text-color);
        }

        /* MOBILE */
        @media (max-width: 768px) {
            .entity-section { grid-template-columns: 1fr; gap: 10px; }
            .entity-header { text-align: left; padding-right: 0; margin-bottom: 10px; }
            .entity-name { border-left: none; border-bottom: 3px solid transparent; padding-left: 0; padding-bottom: 5px; }
            .entity-section.active .entity-name { border-bottom-color: var(--accent-color); }
        }

    </style>
</head>
<body>

    <button class="theme-toggle" id="theme-btn">[ MODE: VOID ]</button>

    <div class="legal-doc">
        <header>
            <div>
                <h1>Corporate Topology</h1>
                <div style="font-size: 0.8rem; margin-top: 5px;">EXHIBIT A: STRUCTURAL HIERARCHY</div>
            </div>
            <div class="meta-data">
                DOC_ID: STRUC_MAP_2025<br>
                STATUS: ACTIVE<br>
                CLASSIFICATION: OPEN
            </div>
        </header>

        <!-- 3D VISUALIZATION -->
        <div class="figure-container">
            <div class="figure-caption">FIGURE 1.1: ISOMETRIC ENTITY STACK (INTERACTIVE)</div>
            <div id="webgl-canvas"></div>
        </div>

        <!-- TEXT CONTENT -->
        <div id="entities-container">
            
            <!-- ENTITY 1: CoCA -->
            <div class="entity-section" id="row-coca" onmouseenter="highlightEntity('coca')" onmouseleave="resetHighlight()">
                <div class="entity-header">
                    <span class="entity-name">CoCA</span>
                    <span class="entity-type">501(c)(3) Non-Profit</span>
                </div>
                <div class="entity-body">
                    <p>The "Church." The absolute parent and holder of conceptual IP. Operates as the spiritual and governance center.</p>
                    <div style="margin-top: 10px;">
                        <span class="relation-tag">OWNER: 100%</span>
                        <span class="relation-tag">BRAND AUTHORITY</span>
                    </div>
                </div>
            </div>

            <!-- ENTITY 2: Name of My -->
            <div class="entity-section" id="row-factory" onmouseenter="highlightEntity('factory')" onmouseleave="resetHighlight()">
                <div class="entity-header">
                    <span class="entity-name">Name of My</span>
                    <span class="entity-type">For-Profit (C-Corp)</span>
                </div>
                <div class="entity-body">
                    <p>The "Factory." Manufacturing and merchandising arm. Generates taxable revenue to support the parent entity via post-tax donations.</p>
                    <div style="margin-top: 10px;">
                        <span class="relation-tag">SUBSIDIARY</span>
                        <span class="relation-tag">REVENUE ENGINE</span>
                    </div>
                    
                    <div class="vendor-box">
                        <div class="vendor-title">Supply Chain / Vendors</div>
                        <div class="vendor-list">
                            <span class="vendor-item">Arena Embroidery (Mfg)</span>
                            <span class="vendor-item">Radix Printing (Mfg)</span>
                            <span class="vendor-item">Google (Ops)</span>
                            <span class="vendor-item">Microsoft (Ops)</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ENTITY 3: Unsubscribe LLC -->
            <div class="entity-section" id="row-school" onmouseenter="highlightEntity('school')" onmouseleave="resetHighlight()">
                <div class="entity-header">
                    <span class="entity-name">Unsubscribe LLC</span>
                    <span class="entity-type">Independent LLC</span>
                </div>
                <div class="entity-body">
                    <p>The "School." Business consulting for creatives. Independent entity with strategic curriculum partnerships with CoCA.</p>
                    <div style="margin-top: 10px;">
                        <span class="relation-tag">STRATEGIC PARTNER</span>
                        <span class="relation-tag">INDEPENDENT</span>
                    </div>

                    <div class="vendor-box">
                        <div class="vendor-title">Vendor Stack</div>
                        <div class="vendor-list">
                            <span class="vendor-item">Google (Workspace)</span>
                            <span class="vendor-item">Amazon (Cloud/Logistics)</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ENTITY 4: COLA -->
            <div class="entity-section" id="row-cola" onmouseenter="highlightEntity('cola')" onmouseleave="resetHighlight()">
                <div class="entity-header">
                    <span class="entity-name">COLA</span>
                    <span class="entity-type">Independent</span>
                </div>
                <div class="entity-body">
                    <p>The "Outlier." Chronicle of Living Artists. Events and community building. Loosely coupled with Unsubscribe LLC.</p>
                    <div style="margin-top: 10px;">
                        <span class="relation-tag">COMMUNITY ARM</span>
                        <span class="relation-tag">SATELLITE</span>
                    </div>
                </div>
            </div>

        </div>

        <footer style="margin-top: 50px; border-top: 2px solid var(--text-color); padding-top: 20px; font-size: 0.6rem; opacity: 0.5; text-transform: uppercase;">
            Generated by System [Gemini-Protocol] <br>
            Compliance: Verified
        </footer>
    </div>

    <script>
        // --- 1. THEME TOGGLE LOGIC ---
        const themeBtn = document.getElementById('theme-btn');
        let isLight = false;

        themeBtn.addEventListener('click', () => {
            isLight = !isLight;
            if(isLight) {
                document.body.setAttribute('data-theme', 'light');
                themeBtn.innerText = "[ MODE: CONCRETE ]";
                update3DColors(true);
            } else {
                document.body.removeAttribute('data-theme');
                themeBtn.innerText = "[ MODE: VOID ]";
                update3DColors(false);
            }
        });

        // --- 2. THREE.JS "BORING CORPORATE MAP" ---
        
        // Scene Setup
        const container = document.getElementById('webgl-canvas');
        const scene = new THREE.Scene();
        // Background color handled by renderer setClearColor
        
        // Camera (Isometric-ish)
        const camera = new THREE.PerspectiveCamera(35, container.clientWidth / container.clientHeight, 0.1, 1000);
        camera.position.set(20, 15, 20);
        camera.lookAt(0, -2, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        container.appendChild(renderer.domElement);

        // Materials
        let mainColor = 0xffffff;
        let accentColor = 0xF40009;
        let dimColor = 0x444444;

        const materialWireframe = new THREE.LineBasicMaterial({ color: dimColor, transparent: true, opacity: 0.3 });
        const materialHighlight = new THREE.LineBasicMaterial({ color: accentColor, linewidth: 2 });
        const materialText = new THREE.MeshBasicMaterial({ color: mainColor });

        // Groups for Entities
        const entities = {};

        // Helper to create "Technical" shapes (Wireframes)
        function createNode(type, position, labelText) {
            const group = new THREE.Group();
            let geometry;
            let edges;

            if (type === 'pyramid') {
                // CoCA (Top)
                geometry = new THREE.ConeGeometry(2, 3, 4);
                edges = new THREE.EdgesGeometry(geometry);
            } else if (type === 'cube') {
                // Factory (Base)
                geometry = new THREE.BoxGeometry(2.5, 2.5, 2.5);
                edges = new THREE.EdgesGeometry(geometry);
            } else if (type === 'sphere') {
                // School (Orbit)
                geometry = new THREE.IcosahedronGeometry(1.5, 1);
                edges = new THREE.EdgesGeometry(geometry);
            } else if (type === 'satellite') {
                // COLA (Small)
                geometry = new THREE.OctahedronGeometry(1, 0);
                edges = new THREE.EdgesGeometry(geometry);
            }

            const line = new THREE.LineSegments(edges, materialWireframe.clone());
            group.add(line);
            group.position.set(position.x, position.y, position.z);
            
            // Internal Logic for Highlight
            group.userData = { originalColor: dimColor, isHovered: false, mesh: line };

            scene.add(group);
            return group;
        }

        // --- BUILD THE MAP ---

        // 1. CoCA (Top Center)
        entities['coca'] = createNode('pyramid', {x: 0, y: 3, z: 0}, "CoCA");

        // 2. Name of My (Bottom Center - Connected to CoCA)
        entities['factory'] = createNode('cube', {x: 0, y: -3, z: 0}, "FACTORY");

        // 3. Unsubscribe (Right Side - Independent)
        entities['school'] = createNode('sphere', {x: 6, y: 0, z: 2}, "SCHOOL");

        // 4. COLA (Far Right - Connected to School)
        entities['cola'] = createNode('satellite', {x: 10, y: -2, z: 5}, "COLA");


        // --- CONNECTIONS (LINES) ---
        function createConnection(startNode, endNode, style = 'solid') {
            const points = [];
            points.push(startNode.position);
            points.push(endNode.position);
            const geometry = new THREE.BufferGeometry().setFromPoints(points);
            
            // Dashed for loose connection, Solid for ownership
            const material = new THREE.LineBasicMaterial({ 
                color: 0x444444, 
                transparent: true, 
                opacity: 0.5 
            }); // Simple lines for boring look

            const line = new THREE.Line(geometry, material);
            scene.add(line);
            return line;
        }

        // Connect CoCA -> Factory (Ownership - Vertical)
        createConnection(entities['coca'], entities['factory']);

        // Connect CoCA -> School (Partnership - Lateral)
        createConnection(entities['coca'], entities['school']);

        // Connect School -> COLA (Community Tie)
        createConnection(entities['school'], entities['cola']);

        // --- ANIMATION LOOP ---
        function animate() {
            requestAnimationFrame(animate);

            // Subtle Rotation of the entire system for "Live" feel
            scene.rotation.y += 0.002;

            // Individual rotations
            entities['coca'].rotation.y -= 0.005;
            entities['factory'].rotation.y += 0.005;
            entities['school'].rotation.x += 0.005;
            entities['school'].rotation.y += 0.005;
            entities['cola'].rotation.z += 0.01;

            renderer.render(scene, camera);
        }
        animate();

        // --- INTERACTION LOGIC ---

        function highlightEntity(id) {
            // Visual Highlight in DOM
            document.querySelectorAll('.entity-section').forEach(el => el.classList.remove('active'));
            const domEl = document.getElementById('row-' + id);
            if(domEl) domEl.classList.add('active');

            // 3D Highlight
            Object.keys(entities).forEach(key => {
                const entity = entities[key];
                const mesh = entity.userData.mesh;
                
                if (key === id) {
                    // Active State
                    mesh.material.color.setHex(accentColor);
                    mesh.material.opacity = 1;
                    mesh.scale.set(1.2, 1.2, 1.2);
                } else {
                    // Dim State
                    mesh.material.color.setHex(dimColor);
                    mesh.material.opacity = 0.2;
                    mesh.scale.set(1, 1, 1);
                }
            });
        }

        function resetHighlight() {
             // Reset DOM
            document.querySelectorAll('.entity-section').forEach(el => el.classList.remove('active'));

            // Reset 3D
            Object.keys(entities).forEach(key => {
                const entity = entities[key];
                const mesh = entity.userData.mesh;
                mesh.material.color.setHex(dimColor);
                mesh.material.opacity = 0.5;
                mesh.scale.set(1, 1, 1);
            });
        }

        // --- COLOR UPDATES ON THEME CHANGE ---
        function update3DColors(lightMode) {
            dimColor = lightMode ? 0x999999 : 0x444444;
            accentColor = lightMode ? 0xcc0000 : 0xF40009;
            const bg = lightMode ? 0xf0f0f0 : 0x050505;
            
            // We don't set renderer background so it's transparent, 
            // but we need to update the line materials
            resetHighlight();
        }
        
        // Handle Resize
        window.addEventListener('resize', () => {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        });

    </script>
</body>
</html>

