<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoCA // HEURISTIC_INSTALLER v2.1</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <style>
        :root {
            --bg: #0a0a0a;
            --text: #d0d0d0;
            --accent: #ff4400;
            --dim: #555;
            --font-main: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            --font-mono: 'Courier New', Courier, monospace;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: var(--font-main);
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            perspective: 1000px;
        }

        /* The WebGL Canvas Container */
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; 
            pointer-events: none;
        }

        #container {
            width: 90%;
            max-width: 600px;
            text-align: left;
            position: relative;
            z-index: 10;
            transform: translateZ(0px);
            text-shadow: 1px 0px 2px rgba(0,0,0,0.5);
            mix-blend-mode: hard-light;
        }

        @keyframes flicker {
            0% { opacity: 0.95; }
            5% { opacity: 0.8; }
            10% { opacity: 0.98; }
            15% { opacity: 0.4; }
            20% { opacity: 0.98; }
            100% { opacity: 0.98; }
        }

        .crt-flicker {
            animation: flicker 10s infinite alternate;
        }

        .header {
            font-family: var(--font-mono);
            font-size: 0.8rem;
            color: var(--dim);
            border-bottom: 1px solid var(--dim);
            padding-bottom: 10px;
            margin-bottom: 40px;
            display: flex;
            justify-content: space-between;
            letter-spacing: 1px;
        }

        h1 {
            font-weight: 300;
            letter-spacing: -1px;
            margin-bottom: 2rem;
            text-transform: uppercase;
            color: #fff;
        }

        .content-step {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .content-step.active {
            display: block;
            opacity: 1;
        }

        p {
            line-height: 1.6;
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
        }

        .highlight {
            color: var(--accent);
            font-family: var(--font-mono);
            font-weight: bold;
            letter-spacing: -0.5px;
        }

        .code-block {
            background: rgba(20, 20, 20, 0.8);
            border-left: 3px solid var(--accent);
            padding: 15px;
            font-family: var(--font-mono);
            font-size: 0.9rem;
            color: #aaa;
            margin: 20px 0;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.5);
        }

        button {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--text);
            color: var(--text);
            padding: 15px 30px;
            font-family: var(--font-mono);
            font-size: 1rem;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
            /* Ensure button is clickable above everything */
            position: relative; 
            z-index: 30; 
        }

        button:hover {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg);
            box-shadow: 0 0 20px var(--accent);
        }

        .progress-container {
            position: absolute;
            bottom: -60px;
            left: 0;
            width: 100%;
            height: 4px;
            background: #222;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent);
            width: 0%;
            transition: width 0.5s cubic-bezier(0.22, 0.61, 0.36, 1);
            box-shadow: 0 0 10px var(--accent);
        }

        /* Scanlines - pointer events none is crucial here */
        .scanlines-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-linear-gradient(
                to bottom,
                transparent 0px,
                transparent 2px,
                rgba(0,0,0,0.3) 3px,
                rgba(0,0,0,0.3) 4px
            );
            pointer-events: none;
            z-index: 20;
        }
    </style>
</head>
<body>

    <div id="canvas-container"></div>
    <div class="scanlines-overlay"></div>

    <div id="container" class="crt-flicker">
        <div class="header">
            <span>[ CoCA // SACRED_DATA ]</span>
            <span>PROTOCOL: ANAMNESIS_V2</span>
        </div>

        <div class="content-step active" id="step1">
            <h1>/ The Shape of Remembering</h1>
            <p>Welcome to the Soft-Architecture Reprogramming Unit.</p>
            <p>We are initiating a diagnostic on your retrieval protocols. Before installation, we must benchmark the legacy system.</p>
            <div class="code-block">
                > QUERY: CHILDHOOD_HOME<br>
                > METHOD: HEURISTIC_FETCH<br>
                > LATENCY: CALIBRATING...
            </div>
            <p>Let the query run. Don't force the output. Wait for the render.</p>
            <button onclick="nextStep(2)">RENDER COMPLETE</button>
        </div>

        <div class="content-step" id="step2">
            <h1>/ Diagnostic Result</h1>
            <p>Analyze the output. Did you retrieve a static file address?</p>
            <p>Or did you generate a <span class="highlight">procedural texture</span> based on a specific quality of light, a smell, or an emotional state?</p>
            <p><strong>Analysis:</strong> Memory is not archived data. It is active reconstruction. You did not fetch the file; you re-rendered the scene using your current emotional GPU.</p>
            <button onclick="nextStep(3)">ACKNOWLEDGE ERROR</button>
        </div>

        <div class="content-step" id="step3">
            <h1>/ The Search Algorithm</h1>
            <p>When you recalled that home, your brain ran a heuristic search optimized for speed, not accuracy.</p>
            <div class="code-block">
                SELECT * FROM neural_net <br>
                WHERE tag LIKE 'childhood%' <br>
                AND current_state = NOW()<br>
                LIMIT 1
            </div>
            <p>This is <span class="highlight">Heuristic Retrieval</span>. You are accepting the first viable pattern match to save processing power. You do this constantly. It is hard-coded into your BIOS.</p>
            <button onclick="nextStep(4)">RUN LOGIC CHECK</button>
        </div>

        <div class="content-step" id="step4">
            <h1>/ Cached Dependencies</h1>
            <p>Execute sequence: 1, 2, 3, 4, 5.</p>
            <p>Did you calculate `n+1`? No. You accessed a pre-compiled look-up table.</p>
            <p>What feels like logic is <span class="highlight">latency-optimized memory</span>. What feels like "fact" is just a groove worn into the cortex by repetition.</p>
            <p>The sequence feels inevitable because it was installed by previous operators (parents, teachers) until it felt like source code.</p>
            <button onclick="nextStep(5)">VIEW ARCHITECTURE</button>
        </div>

        <div class="content-step" id="step5">
            <h1>/ The Overwrite</h1>
            <p>If memory is reconstruction, and logic is just habit, we arrive at the Core Truth:</p>
            <p><span class="highlight">The frameworks you reason from were built, not given.</span></p>
            <p>This is not a system error. It is an exploit. It means the system is writable. We are here to install new heuristics.</p>
            <div class="code-block">
                > ROOT_ACCESS: GRANTED<br>
                > READY TO FLASH BIOS.
            </div>
            <button onclick="nextStep(6)">INSTALL UPDATE</button>
        </div>

        <div class="content-step" id="step6">
            <h1>/ System Updated</h1>
            <p>A Query to run in the background:</p>
            <p style="font-size: 1.5rem; font-weight: 300; color: var(--accent); letter-spacing: -1px; line-height: 1.2;">
                What do you "know" that is actually just a habit you have never examined?
            </p>
            <br>
            <p style="font-size: 0.8rem; color: var(--dim); font-family: var(--font-mono);">[ CONNECTION TERMINATED ]</p>
        </div>

        <div class="progress-container">
            <div class="progress-fill" id="progress"></div>
        </div>
    </div>

    <script>
        // --- HTML INTERACTION ---
        function nextStep(stepNumber) {
            const allSteps = document.querySelectorAll('.content-step');
            const nextStepEl = document.getElementById('step' + stepNumber);

            // 1. Hide all active steps EXCEPT the new one
            allSteps.forEach(step => {
                if(step !== nextStepEl && step.classList.contains('active')) {
                    step.classList.remove('active');
                    // Wait for fade out, then set display none
                    setTimeout(() => { 
                        if(!step.classList.contains('active')) { // Check again to be safe
                            step.style.display = 'none'; 
                        }
                    }, 500);
                }
            });

            // 2. Show the new step
            if (nextStepEl) {
                // Remove display:none immediately so it exists in DOM
                nextStepEl.style.display = 'block';
                // Force a reflow (browser paint) so the transition catches the opacity change
                void nextStepEl.offsetWidth; 
                // Add the active class to trigger fade-in
                nextStepEl.classList.add('active');
            }

            // Update progress bar
            const totalSteps = 6;
            const percentage = ((stepNumber - 1) / (totalSteps - 1)) * 100;
            document.getElementById('progress').style.width = percentage + '%';

            // TRIGGER GLITCH
            if(uniforms) {
                uniforms.u_glitchIntensity.value = 2.0;
                setTimeout(() => { uniforms.u_glitchIntensity.value = 0.2; }, 300);
            }
        }


        // --- THREE.JS WEBGL SHADER BACKGROUND ---
        
        let scene, camera, renderer, uniforms;

        function initWebGL() {
            const container = document.getElementById('canvas-container');
            if(!container) return; // safety check

            scene = new THREE.Scene();
            camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
            renderer = new THREE.WebGLRenderer({ alpha: true });
            renderer.setSize( window.innerWidth, window.innerHeight );
            container.appendChild( renderer.domElement );

            // THE SHADER CODE
            const vertexShader = `
                varying vec2 vUv;
                void main() {
                    vUv = uv;
                    gl_Position = vec4( position, 1.0 );
                }
            `;

            const fragmentShader = `
                uniform float u_time;
                uniform vec2 u_resolution;
                uniform float u_glitchIntensity;
                varying vec2 vUv;

                float noise(vec2 st) {
                    return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
                }

                void main() {
                    vec2 uv = vUv;
                    
                    float n = noise(uv * 3.0 + u_time * 0.1);
                    float n2 = noise(uv * 6.0 - u_time * 0.2);
                    
                    float finalNoise = smoothstep(0.3, 0.7, n * n2);
                    
                    vec3 bgColor = vec3(0.05, 0.05, 0.06);
                    vec3 accentColor = vec3(1.0, 0.2, 0.0); 

                    vec3 color = mix(bgColor, accentColor * 0.3, finalNoise);
                    
                    float shift = noise(vec2(uv.y, u_time * 5.0)) * 0.02 * u_glitchIntensity;
                    float r = noise(vec2(uv.x + shift, uv.y) * 3.0 + u_time * 0.1);
                    float g = noise(vec2(uv.x, uv.y) * 3.0 + u_time * 0.1);
                    float b = noise(vec2(uv.x - shift, uv.y) * 3.0 + u_time * 0.1);
                    
                    vec3 glitchColor = vec3(r,g,b);
                    
                    float scanline = sin(uv.y * u_resolution.y * 0.5) * 0.1;
                    color -= scanline;

                    color = mix(color, glitchColor, u_glitchIntensity * 0.3 * finalNoise);

                    float vignette = 1.0 - smoothstep(0.5, 1.5, length(uv - 0.5) * 2.0);
                    color *= vignette;

                    gl_FragColor = vec4(color, 1.0);
                }
            `;

            uniforms = {
                u_time: { value: 1.0 },
                u_resolution: { value: new THREE.Vector2() },
                u_glitchIntensity: { value: 0.2 } 
            };
            uniforms.u_resolution.value.x = window.innerWidth;
            uniforms.u_resolution.value.y = window.innerHeight;

            const material = new THREE.ShaderMaterial( {
                uniforms: uniforms,
                vertexShader: vertexShader,
                fragmentShader: fragmentShader
            });

            const plane = new THREE.Mesh( new THREE.PlaneGeometry( 2, 2 ), material );
            scene.add( plane );
        }

        function animate() {
            requestAnimationFrame( animate );
            if(uniforms) uniforms.u_time.value += 0.01;
            if(renderer && scene && camera) renderer.render( scene, camera );
        }

        function onWindowResize() {
            if(renderer && uniforms) {
                renderer.setSize( window.innerWidth, window.innerHeight );
                uniforms.u_resolution.value.x = window.innerWidth;
                uniforms.u_resolution.value.y = window.innerHeight;
            }
        }

        window.addEventListener( 'resize', onWindowResize, false );

        initWebGL();
        animate();

    </script>
</body>
</html>
